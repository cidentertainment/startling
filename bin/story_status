#!/usr/bin/env ruby

exit 1 if ARGV.empty?

require_relative '../lib/teaching-channel-start'
TeachingChannelStart.root_dir = TeachingChannelStart.cache_dir = Dir.pwd

module StoryStatusHelper
  def self.token
    @token ||= TeachingChannelStart::Command.new.pivotal_api_token
  end

  def self.api
    @api ||= TeachingChannelStart::PivotalTracker::Api.new(api_token: token)
  end

  def self.story_details(id)
    TeachingChannelStart::PivotalTracker::Story.new(id, api)
  end
end

def story_details(id)
  StoryStatusHelper.story_details(id)
end

story_states = []
ARGV.each do |story_id|
  story_states << story_details(story_id).current_state
end

puts ( story_states.all? { |s| s == "accepted" } ) ?
  "accepted" :
  "unaccepted"
