#!/usr/bin/env ruby

exit 1 if ARGV.empty?

require_relative '../lib/startling_pivotal/api'
require_relative '../lib/startling_pivotal/helper'
require_relative '../lib/startling_pivotal/story'

module StoryStatusHelper
  def self.token
    @token ||= StartlingPivotal::Helper.new.api_token
  end

  def self.api
    @api ||= StartlingPivotal::Api.new(api_token: token)
  end

  def self.story_details(id)
    StartlingPivotal::Story.new(id, api)
  end
end

def story_details(id)
  StoryStatusHelper.story_details(id)
end

story_states = []
ARGV.each do |story_id|
  story_states << story_details(story_id).current_state
end

puts ( story_states.all? { |s| s == "accepted" } ) ?
  "accepted" :
  "unaccepted"
